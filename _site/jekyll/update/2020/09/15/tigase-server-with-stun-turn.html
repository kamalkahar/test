<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="http://localhost:4000/assets/img/favicon.png" />
    <title>Real Time Communication, Presence and Messaging Software Provider</title>
    <link rel="stylesheet" href="http://localhost:4000/assets/css/plugins.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/style.css">
    <link rel="stylesheet" href="assets/css/style.css">
    
    <link rel="preload" href="http://localhost:4000/assets/css/fonts/thicccboi.css" as="style" onload="this.rel='stylesheet'">
    <style>
        .goog-te-banner-frame {
            display: none !important;
            top: 0px !important;
        }
        
        body {
            top: 0px !important;
        }
        
        .goog-te-gadget span {
            display: none !important;
        }
        
        .goog-logo-link {
            display: none !important;
        }
        
        .goog-te-gadget {
            color: transparent !important;
        }
        
        /* .gtrans {
            position: fixed; right: 110px; top: 30px; z-index: 9999;
        } */
        /* .gtrans {
    position: fixed;
    right: 5%;
    top: 0px;
    z-index: 9999;
} */
.gtrans {
    position: fixed;
    right: 1%;
    top: 0px;
    z-index: 9990;
}

/*
@media (min-width:1400px) {
    .gtrans {
    position: fixed;
    right: 5%;
    top: 65px;
    z-index: 9999;
}
}
@media (min-width:1024px) {
    .gtrans {
    position: fixed;
    right: 16%;
    top: 65px;
    z-index: 9999;
}
} */


        .goog-te-gadget .goog-te-combo {
            margin: 4px 0;
    border: none;
    background-color: rgb(255 255 255 / 0%) !important;
    font-size: 14px;
    font-family: THICCCBOI,sans-serif !important;
    color: #a8afbd !important;
    font-weight: 700 !important;
    font-size: .65rem !important;
}



    </style>
</head>

<!-- start header Arae -->
<div class="gtrans"  id="google_translate_element"></div>
<header class="wrapper bg-soft-primary">
    
  
    
  
    <nav class="navbar center-nav transparent navbar-expand-lg navbar-light">
        <div class="container flex-lg-row flex-nowrap align-items-center">
            <div class="navbar-brand w-100"><a href="index.html"><img src="http://localhost:4000/assets/img/logo.png"  alt="" /></a></div>
            <div class="navbar-collapse offcanvas-nav">
                <div class="offcanvas-header d-lg-none d-xl-none">
                    <a href="#"><img src="http://localhost:4000/assets/img/logo0w.png" alt="" /></a>
                    <button type="button" class="btn-close btn-close-white offcanvas-close offcanvas-nav-close" aria-label="Close"></button>
                </div>
                
                <!--<ul class="navbar-nav">
    <li class="nav-item">
        <a class="nav-link" href="index.html">Home</a>-->
                <!--/.dropdown-menu -->
                <!--</li>
    <li class="nav-item ">
        <a class="nav-link " href="aboutus.html">About</a>

    </li>
    <li class="nav-item ">
        <a class="nav-link " href="https://docs.tigase.net/" target="_blank">Documentation</a>

    </li>
    <li class="nav-item ">
        <a class="nav-link " href="download.html">Download</a>

    </li>
    <li class="nav-item ">
        <a class="nav-link " href="community.html">Community</a>

    </li>
    <li class="nav-item">
        <a class="nav-link" href="developer.html">Developers</a>-->
                <!--/.dropdown-menu -->
                <!--</li>
    <li class="nav-item">
        <a class="nav-link" href="donate.html">Donate</a>-->
                <!--/.dropdown-menu -->
                <!--</li>
    <li class="nav-item">
        <a class="nav-link" href="https://tigase.net/" target="_blank">Enterprise</a>-->
                <!--/.dropdown-menu -->
                <!--</li>
    </ul>-->
                <!-- /.navbar-nav -->

                
                <ul class="navbar-nav">
                    
                    <li class="nav-item"><a class="nav-link" href="/os-website/index">Home</a></li>
                    
                    
                    <li class="nav-item"><a class="nav-link" href="/os-website/aboutus">About</a></li>
                    
                    
                    <li class="nav-item"><a class="nav-link" href="https://docs.tigase.net/">Documentation</a></li>
                    
                    
                    <li class="nav-item"><a class="nav-link" href="/os-website/download">Download</a></li>
                    
                    
                    <li class="nav-item"><a class="nav-link" href="/os-website/community">Community</a></li>
                    
                    
                    <li class="nav-item"><a class="nav-link" href="/os-website/donate">Donate</a></li>
                    
                    
                    <li class="nav-item"><a class="nav-link" href="https://tigase.net/">Enterprise</a></li>
                    
                    
                    <li class="nav-item"><a class="nav-link" href="/os-website/blog">Blog</a></li>
                    
                    
                    <a href="http://localhost:4000/de"> de</a> <br>
                    <a href="http://localhost:4000"> en</a>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
            <div class="navbar-other w-10 d-flex ms-auto">
                <ul class="navbar-nav flex-row align-items-center ms-auto" data-sm-skip="true">
                  
                    <li class="nav-item dropdown language-select text-uppercase">

                        <!-- <a class="nav-link dropdown-item dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">En</a> -->
                        <!-- <ul class="dropdown-menu">
                            <li class="nav-item"><a class="dropdown-item" href="#">En</a></li>
                            <li class="nav-item"><a class="dropdown-item" href="#">De</a></li>
                            <li class="nav-item"><a class="dropdown-item" href="#">Es</a></li>
                        </ul> -->
                    </li>
                    
                    <li class="nav-item"><a class="nav-link" data-toggle="offcanvas-info">
                        <i class="uil uil-info-circle"></i></a></li>
                    <li class="nav-item d-lg-none">
                        <div class="navbar-hamburger"><button class="hamburger animate plain" data-toggle="offcanvas-nav"><span></span></button></div>
                    </li>
                </ul>
                <!-- /.navbar-nav -->
            </div>
            <!-- /.navbar-other -->
        </div>
        <!-- /.container -->
    </nav>
    <!-- /.navbar -->
    <div class="offcanvas-info text-inverse">
        <button type="button" class="btn-close btn-close-white offcanvas-close offcanvas-info-close" aria-label="Close"></button>
        <a href="index.html"><img src="http://localhost:4000/assets/img/logo0w.png" alt="" /></a>
        <div class="mt-4 widget">
            <p style="text-align:justify">Getting started with using XMPP never been easier - pick a project you want to build, and let XMPP safely and robustly store your data.</p>
        </div>
        <!-- /.widget -->
        <div class="widget">
            <h4 class="widget-title text-white mb-3">Contact Info</h4>
            <address>4275 Executive Sq.,<br /> Suite 200, La Jolla,<br /> CA 92037 </address>
            <!--<a href="mailto:info@tigase.net">info@tigase.net</a><br /> <a href="tel:+14159004778">+1 (415) 900-4778</a>-->
            <!-- /.widget -->
            <div class="widget"><br />

                <h4 class="widget-title text-white mb-3">Learn More</h4>
                <ul class="list-unstyled">
                    <li><a href="index.html">Our Story</a></li>
                    <li><a href="index.html">Terms of Use</a></li>
                    <li><a href="index.html">Privacy Policy</a></li>
                    <li><a href="index.html">Contact Us</a></li>
                </ul>
            </div>
            <!-- /.widget -->
            <div class="widget">
                <h4 class="widget-title text-white mb-3">Follow Us</h4>
                <nav class="nav social social-white">
                    <a href="https://twitter.com/tigase" target="_blank"><i class="uil uil-twitter"></i></a>
                    <a href="https://www.facebook.com/tigase" target="_blank"><i class="uil uil-facebook-f"></i></a>

                </nav>
                <!-- /.social -->
            </div>
            <!-- /.widget -->
        </div>
        <!-- /.offcanvas-info -->
        </div>
</header>
<!-- /header -->

<section class="wrapper bg-soft-primary">
    <div class="container pt-10 pb-19 pt-md-14 pb-md-20 text-center">
        <div class="row">
            <div class="col-md-10 col-xl-8 mx-auto">
                <div class="post-header">

                    <!-- /.post-category -->
                    <h1 class="display-1 mb-4">Using STUN & TURN server with Tigase XMPP Server with XEP-0215 (External Service Discovery)</h1>
                    <ul class="post-meta mb-5">
                        <li class="post-date"><i class="uil uil-calendar-alt"></i><span>Sep 15, 2020</span></li>

                    </ul>
                    <!-- /.post-meta -->
                </div>
                <!-- /.post-header -->
            </div>
            <!-- /column -->
        </div>
        <!-- /.row -->
    </div>
    <!-- /.container -->
</section>
<!-- /section -->
<section class="wrapper bg-light">
    <div class="container pb-14 pb-md-16">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <div class="blog single mt-n17">
                    <div class="card">
                        <div class="card-body">
                            <p>Communication with your family and friends is not only about instant chats. Audio and Video calls are quite important and sometimes, under unfavourable network configurations establishing a call may prove difficult. Luckily, with the help of <a href="https://en.wikipedia.org/wiki/STUN" style="color:#5a66e8;" target="_blank">STUN (Session Traversal Utilities for NAT)</a> and <a href="https://en.wikipedia.org/wiki/Traversal_Using_Relays_around_NAT" style="color:#5a66e8;" target="_blank">TURN (Traversal Using Relays around NAT)</a> servers it’s no longer a problem</p>

<p>In the following guide we will show how to setup TURN and STUN servers with Tigase XMPP Server, so that compatible XMPP clients will be able to use them. Our <a href="https://xmpp.cloud/" style="color:#5a66e8;" target="_blank">xmpp.cloud installation</a> supports not only them, but also <a href="https://tigase.net/tigase-im-mix/" style="color:#5a66e8;" target="_blank">XMPP MIX</a></p>

<h3><b>Assumptions</b></h3>

<p>We are assuming that you have installed your preferred TURN server and created an account on the TURN server for use by your XMPP server users and that you have installed and configured Tigase XMPP Server.<br /></p>

<p>At the end of the article there is a short guide hot to quickly setup CoTURN server.<br /></p>

<h3><b>Enabling external service discovery <i>(required only for Tigase XMPP Server 8.1.0 and earlier)</i></b></h3>

<p>First you need to edit <mark style="background-color&#x3a; &num;f5f2f0;">etc/config.tdsl</mark> file and:<br /></p>
<ol start="1">
<li><b>Add following line in the main section of the file:</b></li><br />
<mark style="background-color&#x3a; &num;f5f2f0;">ext-disco&apos; () &#123;&#125;</mark>
<br /><br />
<li><b>Add following line in the <mark style="background-color&#x3a; &num;f5f2f0;">sess-man</mark> section of the file:</b></li><br />
<mark style="background-color&#x3a; &num;f5f2f0;">ext-disco&apos; () &#123;&#125;</mark>
</ol>
<p>so that your config file would look like this:<br /></p>
<pre>
&#8217;ext-disco&#8217; ()
 {
  }
&#8217;sess-man&#8217; () {
    &#8217;urn:xmpp:extdisco:2&#8217; () {}
    ...
}
...
</pre>

<h3><b>Start Tigase XMPP Server</b></h3>
<p>After applying changes mentioned above, you need to start Tigase XMPP Server or, in case if it was running, restart it.</p>

<h3><b>Open Admin UI</b></h3>

<p>Open web browser and head to <mark style="background-color&#x3a; &num;f5f2f0;">http://&lt;your-xmpp-server-and-port&gt;/admin/</mark> (for example: <a href="https://localhost:8080" style="color:#5a66e8;" target="_blank">https://localhost:8080</a>). When promped, log in by providing admin user credentials: bare JID (i.e.: <mark style="background-color&#x3a; &num;f5f2f0;">user@domain</mark>) as the user and related password. Afterwards you’ll see main Web AdminUI screen:</p>

<center><img src="http://localhost:4000assets/img/blog/web-admin-main-page.png" style="width:50%;" /><br /><br /></center>
<p><br /></p>

<p>and on that screen open <b>Configuration</b> group on the left by clicking on it.</p>

<h3><b>Add external TURN service</b></h3>

<p>After opening <b>Configuration</b> group (1) click on <b>Add New Item</b> (2) position which has <b>ext-disco@…</b> in its subtitle.<br /></p>

<p>In the opened form you need to provide following detail:<br /></p>

<center><img src="http://localhost:4000assets/img/blog/web-admin-add-new-turn-item.png" style="width:50%;" /><br /><br /></center>
<p><br /></p>

<ul>
<li>Service - ID of the service which will be used for identification by Tigase XMPP Server (ie. turn@example.com)</li>
<li>Service name - name of the service which may be presented to the user (ie. TURN server)</li>
<li>Host - fully qualified domain name of the TURN server or its IP address (ie. turn.example.com)</li>
<li>Port - port at which TURN server listens (ie. 3478)</li>
<li>Type - type of the server, enter turn</li>
<li>Transport - type of transport used for communication with the server udp or tcp (usually udp)</li>
<li>Requires username and password - for notifying XMPP client that this service requires its username and password for XMPP service (leave unchecked)</li>
<li>Username - username required for authentication for TURN server (ie. turn-user)</li>
<li>Password - password required for authentication for TURN server (ie. turn-password)</li>

</ul>
<p>After filling out the form, press Submit button (3) to send form and add a TURN server to external services for your server.<br /> Admin UI will 
confirm that service was added with the following result<br /></p>

<center><img src="http://localhost:4000assets/img/blog/web-admin-add-new-item-confirmation.png" style="width:50%;" /><br /><br /></center>
<p><br /></p>

<h3><b>Add external STUN service</b></h3>

<p>While adding a TURN server is usually all what you need, in some cases you may want to allow your users to use also STUN. Steps are quite similar like on TURN server - after opening <b>Configuration</b> group (1) click on <b>Add New Item</b> (2) position which has <b>ext-disco@…</b> in its subtitle and in the opened form you need to provide following detail:</p>

<center><img src="http://localhost:4000assets/img/blog/web-admin-add-new-stun-item.png" style="width:50%;" /><br /><br /></center>
<p><br /></p>

<ul>
<li>Service - ID of the service which will be used for identification by Tigase XMPP Server (ie. stun@example.com)</li>
<li>Service name - name of the service which may be presented to the user (ie. STUN server)</li>
<li>Host - fully qualified domain name of the STUN server or its IP address (ie. stun.example.com)</li>
<li>Port - port at which TURN server listens (ie. 3478)</li>
<li>Type - type of the server, enter turn</li>
<li>Transport - type of transport used for communication with the server udp or tcp (usually udp)</li>
<li>Requires username and password - for notifying XMPP client that this service requires its username and password for XMPP service (leave unchecked)</li>
<li>Username - username required for authentication for STUN server (if required)</li>
<li>Password - password required for authentication for STUN server (if required)</li>

</ul>

<h3><b>Note</b></h3>

<p>If you are using the same server for STUN and TURN (you usually will as TURN servers usually contain STUN functionality) you will fill the following form with almost the same details *(only use different <b>Service</b> field value, <b>Type</b> will be stun and most likely you will skip passing <b>Username</b> and <b>Password</b> - leaving them empty, the rest of the field values will be the same).<br /></p>

<p>After filling out the form, press Submit button (3) to send form and add a STUN server to external services for your server. Admin UI will confirm that service was added with the following result</p>

<center><img src="http://localhost:4000assets/img/blog/web-admin-add-new-item-confirmation.png" style="width:50%;" /><br /><br /></center>
<p><br /></p>

<h3><b>And now what?</b></h3>

<p>Now you have fully configured your STUN/TURN server for usage with Tigase XMPP Server allowing XMPP clients connected to your server and compatible with <a href="https://xmpp.org/extensions/xep-0215.html" style="color:#5a66e8;" target="_blank">XEP-0215: External Service Discovery</a> to take full advantage of your STUN/TURN server ie. by providing better VoIP experience.</p>

<h3><b>CoTURN installation</b></h3>

<p>You can quickly setup CoTURN server using Docker. Please follow Docker installation on your operating system and then install CoTURN using <a href="https://hub.docker.com/r/instrumentisto/coturn" style="color:#5a66e8;" target="_blank">Docker Hub</a> (instrumentisto/coturn). The bare minimum required to run it looks like that (please update realm with your domain and external-ip with IP on which server should be accessible):</p>

<p><mark style="background-color&#x3a; &num;f5f2f0;">sudo docker run --name coturn -d --network=host --restart always  instrumentisto/coturn -n --log-file=stdout --min-port=49160 --max-port=49200 --realm=awesomexmpp.net --external-ip=&lt;external_ip&gt; -a'</mark><br /></p>

<p>Subsequently, add user to CoTURN with password and domain:<br /></p>

<p><mark style="background-color&#x3a; &num;f5f2f0;">sudo docker exec -i -t coturn turnadmin -a -u tigase -r awesomexmpp.net -p Ajbk7Ck38nIobLVl</mark></p>

                        </div>
                    </div>
                    <!-- /.card -->
                </div>
                <!-- /.blog -->
            </div>
            <!-- /column -->
        </div>
        <!-- /.row -->
    </div>
    <!-- /.container -->
</section>
<!-- /section -->

<footer class="bg-navy text-inverse">
    <div class="container pt-15 pt-md-17 pb-13 pb-md-15">
        <div class="d-lg-flex flex-row align-items-lg-center">
            <h3 class="display-4 mb-6 mb-lg-0 pe-lg-20 pe-xl-22 pe-xxl-25 text-white" style="text-align:left;">Getting started with using XMPP never been easier - pick a project you want to build, and let XMPP safely and robustly store your data.</h3>
            <a href="download" class="btn btn-primary rounded-pill mb-0 text-nowrap">Try It For Free</a>
        </div>
        <!--/div -->
        <hr class="mt-11 mb-12" />
        <div class="row gy-6 gy-lg-0">
            <div class="col-md-4 col-lg-3">
                <div class="widget">
                    <a href="index.html"><img class="mb-4" src="http://localhost:4000assets/img/logow.png" alt="" /></a>

                    <p class="mb-4">© 2021 Tigase. <br class="d-none d-lg-block" />All rights reserved.</p>
                    <nav class="nav social social-white">
                        <a href="https://www.twitter.com/tigase" target="_blank"><i class="uil uil-twitter"></i></a>
                        <a href="https://www.facebook.com/tigase" target="_blank"><i class="uil uil-facebook-f"></i></a>

                    </nav>
                    <!-- /.social -->
                </div>
                <!-- /.widget -->
            </div>
            <!-- /column -->
            <div class="col-md-4 col-lg-3">
                <div class="widget">
                    <h4 class="widget-title text-white mb-3"><a href="https://github.com/tigase/tigase-server/issues" target="_blank">Get in Touch</a></h4>
                    <address class="pe-xl-15 pe-xxl-17">4275 Executive Sq., Suite 200, La Jolla, CA 92037</address>
                    <!--<a href="mailto:info@tigase.net">info@tigase.net</a><br /> <a href="tel:+14159004778">+1 (415) 900-4778</a>-->
                </div>
                <!-- /.widget -->
            </div>
            <!-- /column -->
            <div class="col-md-4 col-lg-3">
                <div class="widget">
                    <h4 class="widget-title text-white mb-3">XMPP Software</h4>
                    <ul class="list-unstyled mb-0">
                        <li>
                            <a href="https://github.com/tigase/tigase-server" target="_blank">XMPP Server Project</a>
                        </li>
                        <!--<li>
                            <a href="#">XMPP Clients</a>
                        </li>
                        <li>
                            <a href="#">XMPP Libraries</a>
                        </li>-->

                    </ul>
                </div>
                <!-- /.widget -->
            </div>
            <!-- /column -->
            <div class="col-md-12 col-lg-3">
                <div class="widget">
                    <h4 class="widget-title text-white mb-3">Newsletter</h4>
                    <p class="mb-5">

                    <p>Subscribe to TIGASE Stay up to date with news and updates in our software</p>
                    </p>
                    <div class="newsletter-wrapper">
                        <!-- Begin Mailchimp Signup Form -->
                        <div id="mc_embed_signup2">
                            <form action="#" method="post">
                                <div id="mc_embed_signup_scroll2">
                                    <div class="mc-field-group input-group form-label-group">
                                        <input type="email" value="" name="EMAIL" class="required email form-control" placeholder="Email Address" id="mce-EMAIL2">
                                        <label for="mce-EMAIL2">Email Address</label>
                                        <input type="submit" value="Join" name="subscribe" id="mc-embedded-subscribe2" class="btn btn-primary">
                                    </div>
                                    <div id="mce-responses2" class="clear">
                                        <div class="response" id="mce-error-response2" style="display:none"></div>
                                        <div class="response" id="mce-success-response2" style="display:none"></div>
                                    </div> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_ddc180777a163e0f9f66ee014_4b1bcfa0bc" tabindex="-1" value=""></div>
                                    <div class="clear"></div>
                                </div>
                            </form>
                        </div>
                        <!--End mc_embed_signup-->
                    </div>
                    <!-- /.newsletter-wrapper -->
                </div>
                <!-- /.widget -->
            </div>
            <!-- /column -->
        </div>
        <!--/.row -->
    </div>
    <!-- /.container -->
</footer>


<div class="progress-wrap">
    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" />
    </svg>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous"></script>


<!-- <script src="http://localhost:4000assets/js/bootstrap.bundle.min.js"></script> -->

<script src="http://localhost:4000assets/js/jquery.min.js"></script>
<script src="http://localhost:4000assets/js/plugins.js"></script>
<script src="http://localhost:4000assets/js/theme.js"></script>

    <script>
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                    pageLanguage: 'en'
                },
                'google_translate_element'
            );
        }
    </script>
    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

